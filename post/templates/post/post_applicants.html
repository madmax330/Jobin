{% extends 'company/company_base.html' %}

{% load staticfiles %}
{% block scripts %}
    <script type="text/javascript" src="{% static 'post/applicants_filter_script.js' %}"></script>
{% endblock %}

{% block title %}Post Applicants{% endblock %}

{% block postactive %}active{% endblock %}

{% block side_content %}
    {% include 'company/post_info.html' %}
    {% include 'company/applicant_legend.html' %}
    <div class="panel panel-default regular-panel">
        <div class="panel-heading">
            <h4 style="text-align: center;">Filters</h4>
        </div>
        <div class="panel-body">
            <form id="filter-form" class="form form-horizontal" action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <h5>Schools:</h5>
                <div class="sdiv">
                    {% for x in schools %}
                        <input class="school-val" type="checkbox" name="{{ x.name }}" value="{{ x.name }}">
                        <span> - {{ x.name }}</span><br/>
                    {% endfor %}
                </div>
                <h5>Majors:</h5>
                <div class="mdiv">
                    {% if majors.count > 0 %}
                        {% for x in majors %}
                            <input class="major-val" type="checkbox" name="{{ x.name }}" value="{{ x.name }}">
                            <span> - {{ x.name }}</span><br/>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-warning">
                            <p>This post is for all majors</p>
                        </div>
                    {% endif %}
                </div>
                <h5>GPA:</h5>
                <input id="id_gpa_filter" class="form-control" type="text" name="gpa_filter" value="{{ gpa_val }}"/>
                <input id="school-input" style="display: none;" name="schools" value="{{ school_val }}">
                <input id="major-input" style="display: none;" name="majors" value="{{ major_val }}">
                <input id="keepCheckbox" style="margin-top:10px;" type="checkbox" name="keep" checked/>
                <span>Keep applications that are not in filtered values.</span><br/>
                <div id="checkWarning" class="alert alert-danger hidden">
                    <p>Unchecking this checkbox means that all the applicants who do not fit the filter
                        criteria will be discarded. Be sure that this is what you want because this action is
                        irreversible.</p>
                </div>
                <a href="{% url 'post:applicants' pk=post.pk %}" class="btn regular-btn">Remove Filter</a>
                <button class="btn btn-default regular-btn" type="submit">Filter</button>
                <div class="hidden">
                    <input id="page" type="number" name="page" value="{{ page }}"/>
                    <div id="page-ids">page</div>
                    <div id="current-page">{{ page }}</div>
                    <div id="form-id">filter-form</div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="btn-group btn-group-justified">
        <div class="btn-group">
            <button class="btn applicant-view-btn active-applicant-view-btn" style="border-right: none;">
                Multiple Applicants View
            </button>
        </div>
        <div class="btn-group">
            <a href="{% url 'post:applicant' pk=post.pk ak=0%}"
               class="btn applicant-view-btn" style="border-left: none;">
                Single Applicant View
            </a>
        </div>
    </div>
    <div class="panel panel-default primary-panel margined">
        <div class="panel-heading">
            <h3 style="text-align: center;">Post Applicants ({{ count }}):</h3>
        </div>
        <div class="panel-body">
            <table class="table">
                <tr>
                    <th>Name</th>
                    <th>School</th>
                    <th>Program</th>
                    <th>Major</th>
                    <th>Date Applied</th>
                    <th></th>
                </tr>
                {% for x in list %}
                    <tr {% if x.resume_notified %}
                        style="background-color: #E3DAFF"
                    {% elif x.cover_opened %}
                        style="background-color: #96beff;"
                    {% elif x.cover_submitted %}
                        style="background-color: #c2f9ce;"
                    {% elif x.cover_requested %}
                        style="background-color: #fdffb2;"
                    {% endif %}>
                        <td>
                            <a href="{% url 'post:applicant' pk=post.pk ak=x.pk%}">
                                {{ x.fname }} {{ x.lname }}{% if not x.app_opened %} (<b>new</b>){% endif %}
                            </a>
                        </td>
                        <td>{{ x.school }}</td>
                        <td>{{ x.program }}</td>
                        <td>{{ x.major }}</td>
                        <td>{{ x.date_applied }}</td>
                        <td>
                            <a href="#" style="color: red;" class="warning-open">Discard</a>
                            <div class="warning alert alert-warning hidden">
                                <h4>Are you sure you want to discard this applicant?</h4>
                                <hr/>
                                <p>This will permanently remove him from the
                                    list of applicants and cancel his application.</p>
                                <button class="warning-close btn regular-btn" type="button">Cancel</button>
                                <a href="{% url 'post:discard' pk=x.post.pk ak=x.pk %}"
                                   class="btn danger-btn">Discard Applicant</a>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                    <tr>
                        <td colspan="6">
                            <span>Page: </span><span class="hidden page-object">page</span>
                            {% for x in pages %}
                                {% if x == page %}
                                    <strong><span>{{ x }} </span></strong>
                                {% else %}
                                    <span class="app-page-number page-number">{{ x }} </span>
                                {% endif %}|
                            {% endfor %}
                        </td>
                    </tr>
            </table>
            <div class="margined">
                <a href="{% url 'post:companyposts' %}" class="btn regular-btn">Back to List</a>
                <a href="{% url 'post:companypost' pk=post.pk %}" class="btn regular-btn">Back to Post Details</a>
            </div>

        </div>
    </div>
    <script>
        $(function(){
            $("#filter-form").submit(function(){
                var page = $('#page');
                page.val(parseInt(page.val()) - 1);
                var sch = $('#school-input');
                var maj = $('#major-input');
                var schools = "";
                var majors = "";
                $(".sdiv").children("input:checked").each(function(){
                    schools = schools + this.value + ",";
                });
                $(".mdiv").children("input:checked").each(function(){
                    majors = majors + this.value + ",";
                });
                if(sch.val() != ""){
                    var sval = sch.val().toString();
                    sch.val(sval.substring(0, sval.length - 1));
                }
                else
                    sch.val(schools.substring(0,schools.length-1));
                if(maj.val() != ""){
                    var mval = maj.val().toString();
                    maj.val(mval.substring(0, mval.length - 1));
                }
                else
                    maj.val(majors.substring(0,majors.length-1));
            });

            $('#keepCheckbox').click(function(){
                if(!this.checked){
                    $('#checkWarning').removeClass('hidden');
                }
                else{
                    $('#checkWarning').addClass('hidden');
                }
            });
        });
    </script>
{% endblock %}